<link rel="import" href="./bower_components/polymer/polymer.html">
<link rel="import" href="./bower_components/core-icons/core-icons.html">
<link rel="import" href="./bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="./bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="./bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="./bower_components/paper-shadow/paper-shadow.html">

<polymer-element name="regression-results-widget">
  <template>
  <style>
    #feature-cards {
      height: 100%;
    }

    .card-wrapper{
      width: 80%;
      height: 15%;
      min-height: 60px;
      margin-left: auto;
      margin-right: auto;
      padding-top: 5px;
      padding-bottom: 5px;
      margin-top: 10px;
      margin-bottom: 10px;
      background-color: white;
    }

    #feature-cards .card {
      width: 100%;
      height: 100%;
    }

    #feature-cards .card .name {
      font-size: 25px;
      padding-left: 5px;
    }

    #feature-cards .card .status {
      position: absolute;
      right: 0px;
      top: 0px;
      height: 60%;
      width: 10%;
    }

    #feature-cards .card .tags {
      position: absolute;
      left: 0px;
      bottom: 5px;
      font-size: 12px;
      padding-left: 5px;
      color: blue;
    }

    .passed-regression {
      background-color: #B2FF59;
    }

    .passed-feature {
      color: #64DD17;
    }

    .failed-regression {
      background-color: #FF8A80;
    }

    .failed-feature {
      color: #D50000;
    }

    core-toolbar{
      background-color: #424242;
      color: white;
    }

    core-animated-pages{
      background-color: #EEEEEE;
    }

  </style>
  <!-- class="{{regressionPassed? 'passed-regression' : 'failed-regression'}}" -->
  <core-toolbar>
    <core-icon-button icon="{{selectedId === 0? 'menu' : 'arrow-back'}}" on-tap="{{clearSelected}}"></core-icon-button>
    <div flex>Regression Result</div>
    <div>Debug: Selected = {{selectedId}}</div>
  </core-toolbar>
  <core-animated-pages id="results" flex transitions="cross-fade-all hero-transition" selected="{{selectedId}}">
    <section vertical layout>
      <div id="feature-cards" cross-fade>
        <template repeat="{{feature in features}}">
          <paper-shadow z="1" class="card-wrapper">
          <div class="card" hero-id="{{feature.featureId}}" hero?="{{selectedId === 0 || selectedId === feature.featureId}}" on-tap="{{selectFeature}}">
            <div class="name">{{feature.name}}</div>
            <core-icon class="status {{feature.status == 'Passed'? 'passed-feature':'failed-feature'}}" icon="{{feature.status == 'Passed'? 'check' : 'close'}}"></core-icon>
            <div class="tags">{{feature.tags}}</div>
          </div>
        </paper-shadow>
        </template>
      </div>
    </section>
    <template repeat="{{feature in features}}">
      <section class="feature-view" hero-id="{{feature.featureId}}" hero?="{{selectedId === 0 || selectedId === feature.featureId}}" layout vertical>
        <div class="fade-wrapper" cross-fade>
          <div class="name">{{feature.name}}</div>
          <div class="status">{{feature.status}}</div>
          <div class="tags">{{feature.tags}}</div>
        </div>
      </section>
    </template>
  </core-animated-pages>
</template>
<script>
Polymer({
  features: [],
  selectedId: 0,
  ready: function(){
    this.loadData();
  },
  selectFeature: function(e){
    this.selectedId = e.target.templateInstance.model.feature.featureId;
    console.log('Selected: ' + this.selectedId);
  },
  clearSelected: function(){
    if(this.selectedId != 0){
      console.log('Clearing selected!');
      this.selectedId = 0;
    }
  },
  regressionPass: function(){
    var passed = true;

    for(i = 0; i < features.length; i++){
      if(features[i].status == 'Failed'){
        passed = false;
        break;
      }
    }

    return passed;
  },
  loadData: function(){
    this.features = new Array({
      featureId: 1,
      name: 'Linux.TMS.Onboarding.Basic',
      tags: ['@it-wasnt-my-fault','@dont-blame-me'],
      status: 'Failed'
    },{
      featureId: 2,
      name: 'Linux.TMS.Onboarding.Advanced',
      tags: ['@not-real','@imaginary','@made-up', '@quarantined'],
      status: 'Passed'
    },{
      featureId: 3,
      name: 'Linux.TMS.Everify.DuplicateCase',
      tags: ['@not-real','@imaginary','@made-up', '@quarantined'],
      status: 'Passed'
    },{
      featureId: 4,
      name: 'Linux.Jobseeker.Events.Registration',
      tags: ['@not-real','@imaginary','@made-up', '@quarantined'],
      status: 'Passed'
    },{
      featureId: 5,
      name: 'Signin',
      tags: ['@tms', '@signin'],
      status: 'Failed',
      scenarios: new Array({
        name: 'HiringManager',
        type: 'Outline',
        tags: ['@hiringmanager'],
        status: 'Passed',
        steps: new Array({
          stepId: 1,
          stepText: 'Given I navigate to TMS',
          codeLine: 'features/step_definitions/common/navigation_stebs.rb:7',
          status: 'Passed'
        },{
          stepId: 2,
          stepText: 'Then I enter value "<InvalidUserName>" into field with id "UserName"',
          codeLine: 'features/step_definitions/common/controls/generic.rb:121',
          status: 'Passed',
        },{
          stepId: 3,
          stepText: 'Then I enter value "<InvalidPassword>" into field with id "Password"',
          codeLine: 'features/step_definitions/common/controls/generic.rb:121',
          status: 'Passed'
        },{
          stepId: 4,
          stepText: 'Then I click on element with a "name" attribute with value "save"',
          codeLine: 'features/step_definitions/common/controls/generic.rb:88',
          status: 'Passed'
        },{
          stepId: 5,
          stepText: 'Then I see something',
          codeLine: 'features/step_definitions/common/controls/generic.rb:2',
          status: 'Passed'
        }),
        example: {
          inputs: new Array('TestUser', 'TestPassword', 'abdonqobe', 'apib380w'),
          status: 'Passed'
        }
      },{
        name: 'HiringManager',
        type: 'Outline',
        tags: ['@hiringmanager'],
        status: 'Failed',
        steps: new Array({
          stepId: 1,
          stepText: 'Given I navigate to TMS',
          codeLine: 'features/step_definitions/common/navigation_stebs.rb:7',
          status: 'Passed',
        },{
          stepId: 2,
          stepText: 'Then I enter value "<InvalidUserName>" into field with id "UserName"',
          codeLine: 'features/step_definitions/common/controls/generic.rb:121',
          status: 'Passed',
        },{
          stepId: 3,
          stepText: 'Then I enter value "<InvalidPassword>" into field with id "Password"',
          codeLine: 'features/step_definitions/common/controls/generic.rb:121',
          status: 'Passed'
        },{
          stepId: 4,
          stepText: 'Then I click on element with a "name" attribute with value "save"',
          codeLine: 'features/step_definitions/common/controls/generic.rb:88',
          status: 'Passed'
        },{
          stepId: 5,
          stepText: 'Then I see something',
          codeLine: 'features/step_definitions/common/controls/generic.rb:2',
          status: 'Failed',
          exception: {
            exceptionText: 'Unable to find css "#nav-employees" (Capybara::ElementNotFound)',
            stackTrace: 'C:/Ruby200/lib/ruby/gems/2.0.0/gems/capybara-2.4.4/lib/capybara/node/finders.rb:41:in `block in find' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/capybara-2.4.4/lib/capybara/node/base.rb:84:in `synchronize' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/capybara-2.4.4/lib/capybara/node/finders.rb:30:in `find' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/capybara-2.4.4/lib/capybara/session.rb:676:in `block (2 levels) in ' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/capybara-2.4.4/lib/capybara/dsl.rb:51:in `block (2 levels) in ' +
            'C:/Git/cucumber-web/features/step_definitions/common/selection_steps.rb:54:in `block in ' +
            'C:/Ruby200/bin/cucumber:23:in `load' +
            'C:/Ruby200/bin/cucumber:23:in `' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/ruby-debug-ide-0.4.23.beta1/lib/ruby-debug-ide.rb:86:in `debug_load' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/ruby-debug-ide-0.4.23.beta1/lib/ruby-debug-ide.rb:86:in `debug_program' +
            'C:/Ruby200/lib/ruby/gems/2.0.0/gems/ruby-debug-ide-0.4.23.beta1/bin/rdebug-ide:110:in `' +
            '-e:1:in `load\'' +
            '-e:1:in \'' +
            'C:\\Git\\cucumber-web\\features\\tms\\signin.feature:23:in \'Then I wait 60 seconds to see element with id "nav-employees"\''
          }
        }),
        example: {
          inputs:['TestUser', 'TestPassword', 'abdonqobe', 'apib380w'],
          status: 'Passed'
        }
      })
    });
  }
});
</script>
</polymer-element>
